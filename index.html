<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SpeakMaster AI</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg, #4e73df, #1cc88a);
  color: white;
  text-align: center;
  padding: 20px;
}

.container {
  background: rgba(0,0,0,0.3);
  padding: 20px;
  border-radius: 15px;
  max-width: 600px;
  margin: auto;
}

.status {
  display: flex;
  justify-content: space-around;
  margin-bottom: 10px;
  font-weight: bold;
}

select, button {
  padding: 10px;
  font-size: 16px;
  border-radius: 8px;
  margin: 5px;
}

button {
  border: none;
  cursor: pointer;
}

#micBtn {
  background: #f6c23e;
}

.result {
  margin-top: 15px;
}
</style>
</head>

<body>

<h1>ğŸ¤ SpeakMaster AI</h1>

<!-- ğŸ¼ MASCOTA -->
<img id="mascot"
     src="img/Copilot1.png"
     style="width:120px; margin:15px auto; display:block;"
     alt="Emoji">

<div class="container">

<!-- ğŸ”¹ ESTADO -->
<div class="status">
  <div>â¤ï¸ Vidas: <span id="lives">3</span></div>
  <div>ğŸ”¥ Racha: <span id="streak">0</span></div>
  <div>â­ Puntaje: <span id="points">0</span></div>
</div>

<div><strong>Nivel:</strong> <span id="levelText">ğŸŸ¢ FÃ¡cil</span></div>

<!-- ğŸ”¹ MENÃšS -->
<select id="languageSelect">
  <option value="en-US">ğŸ‡ºğŸ‡¸ InglÃ©s</option>
  <option value="fr-FR">ğŸ‡«ğŸ‡· FrancÃ©s</option>
  <option value="de-DE">ğŸ‡©ğŸ‡ª AlemÃ¡n</option>
  <option value="it-IT">ğŸ‡®ğŸ‡¹ Italiano</option>
  <option value="ru-RU">ğŸ‡·ğŸ‡º Ruso</option>
</select>

<select id="difficultySelect">
  <option value="easy">ğŸŸ¢ FÃ¡cil</option>
  <option value="medium">ğŸŸ¡ Medio</option>
  <option value="hard">ğŸ”´ DifÃ­cil</option>
</select>

<hr>

<h2>Repite la frase:</h2>
<p id="targetSentence"></p>

<button id="micBtn">ğŸ¤ Hablar</button>

<div class="result">
  <p><strong>Dijiste:</strong> <span id="spokenText"></span></p>
  <p><strong>PuntuaciÃ³n:</strong> <span id="score"></span></p>
  <p id="feedback"></p>
</div>

<button onclick="nextPhrase()">â¡ï¸ Siguiente</button>
<button onclick="retry()">ğŸ” Reintentar</button>

</div>

<script>
/* ğŸ”¹ FRASES */
const phrases = {
  "en-US": {
    easy: ["I like apples", "Good morning"],
    medium: ["Practice makes perfect"],
    hard: ["I like to learn English every day"]
  },
  "fr-FR": {
    easy: ["Bonjour", "J'aime les pommes"],
    medium: ["La pratique rend parfait"],
    hard: ["J'aime apprendre le franÃ§ais chaque jour"]
  },
  "de-DE": {
    easy: ["Guten Morgen", "Ich mag Ã„pfel"],
    medium: ["Ãœbung macht den Meister"],
    hard: ["Ich lerne jeden Tag Deutsch"]
  },
  "it-IT": {
    easy: ["Buongiorno", "Mi piacciono le mele"],
    medium: ["La pratica rende perfetti"],
    hard: ["Mi piace imparare l'italiano ogni giorno"]
  },
  "ru-RU": {
    easy: ["Ğ”Ğ¾Ğ±Ñ€Ğ¾Ğµ ÑƒÑ‚Ñ€Ğ¾", "Ğ¯ Ğ»ÑĞ±Ğ»Ñ ÑĞ±Ğ»Ğ¾ĞºĞ¸"],
    medium: ["ĞŸÑ€Ğ°ĞºÑ‚Ğ¸ĞºĞ° Ğ´ĞµĞ»Ğ°ĞµÑ‚ Ğ¸Ğ´ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¼"],
    hard: ["ĞœĞ½Ğµ Ğ½Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑÑ ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ñ€ÑƒÑÑĞºĞ¸Ğ¹ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ"]
  }
};

/* ğŸ”¹ ESTADO USUARIO */
let user = {
  lives: 3,
  streak: 0,
  points: 0
};

let index = 0;

/* ğŸ”¹ ELEMENTOS */
const target = document.getElementById("targetSentence");
const spoken = document.getElementById("spokenText");
const scoreEl = document.getElementById("score");
const feedback = document.getElementById("feedback");
const mascot = document.getElementById("mascot");

const langSel = document.getElementById("languageSelect");
const diffSel = document.getElementById("difficultySelect");

/* ğŸ”¹ SPEECH */
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
const recognition = new SpeechRecognition();

document.getElementById("micBtn").onclick = () => {
  recognition.lang = langSel.value;
  recognition.start();
};

recognition.onresult = e => {
  const said = e.results[0][0].transcript.toLowerCase();
  const expected = target.innerText.toLowerCase();

  spoken.innerText = said;

  let score = similarity(expected, said);
  scoreEl.innerText = score + "%";

  if (score >= 70) {
    user.streak++;
    user.points += score;
  } else {
    user.lives--;
    user.streak = 0;
  }

  unlockLevel();
  showFeedback(score);
  updateUI();
};

/* ğŸ”¹ FUNCIONES */
function similarity(a,b){
  let aw=a.split(" "), bw=b.split(" "), c=0;
  aw.forEach(w=>{ if(bw.includes(w)) c++; });
  return Math.round(c/aw.length*100);
}

function loadPhrase(){
  const list = phrases[langSel.value][diffSel.value];
  target.innerText = list[index % list.length];
}

function nextPhrase(){
  index++;
  loadPhrase();
}

function retry(){
  spoken.innerText="";
  scoreEl.innerText="";
  feedback.innerText="";
}

function updateUI(){
  document.getElementById("lives").innerText = user.lives;
  document.getElementById("streak").innerText = user.streak;
  document.getElementById("points").innerText = user.points;
  document.getElementById("levelText").innerText =
    diffSel.options[diffSel.selectedIndex].text;
}

function unlockLevel(){
  if (user.streak === 3) {
    if (diffSel.value === "easy") diffSel.value = "medium";
    else if (diffSel.value === "medium") diffSel.value = "hard";
    user.streak = 0;
    index = 0;
    loadPhrase();
    alert("ğŸ”¥ Â¡Nivel desbloqueado!");
  }
}

/* ğŸ¼ FEEDBACK + MASCOTA */
function showFeedback(score) {
  if (score >= 90) {
    feedback.textContent = "âœ… Excelente pronunciaciÃ³n";
    feedback.style.color = "lime";
    mascot.src = "img/emojihappy.png";
  } else if (score >= 70) {
    feedback.textContent = "âš ï¸ Casi perfecto";
    feedback.style.color = "orange";
    mascot.src = "img/emojinormal.png";
  } else {
    feedback.textContent = "âŒ Intenta de nuevo";
    feedback.style.color = "red";
    mascot.src = "img/emojisad.png";
  }
}

/* ğŸ”¹ EVENTOS */
langSel.onchange = () => { index=0; loadPhrase(); };
diffSel.onchange = () => { index=0; loadPhrase(); };

updateUI();
loadPhrase();
</script>

</body>
</html>